generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Study {
  id        Int      @id @default(autoincrement())
  number    String   @unique
  name      String?
  createdAt DateTime @default(now())
  quotes    Quote[]
}

model ProductType {
  id                Int       @id @default(autoincrement())
  name              String    @unique
  flatWidthFormula  String    @default("l")
  flatHeightFormula String    @default("L")
  elements          Element[]
  quotes            Quote[]
}

model Element {
  id            Int         @id @default(autoincrement())
  name          String
  productTypeId Int
  quantity      Int         @default(1)
  productType   ProductType @relation(fields: [productTypeId], references: [id], onDelete: Cascade)
}

model Plate {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  width    Int
  height   Int
  cost     Float
  material String
  quotes   Quote[]
}

model Accessory {
  id               Int              @id @default(autoincrement())
  name             String
  description      String?
  price            Float
  supplier         String?
  weight           Float?
  quoteAccessories QuoteAccessory[]
}

model Quote {
  id              Int              @id @default(autoincrement())
  reference       String?          @unique
  studyId         Int
  productTypeId   Int
  quantity        Int
  width           Int
  height          Int
  flatWidth       Int?
  flatHeight      Int?
  printSurface    Int?
  cuttingMinutes  Int?
  assemblySeconds Int?
  packSeconds     Int?
  plateId         Int?
  itemsPerPlate   Int?
  platesCount     Int?
  totalCost       Float?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  userId          String?
  plate           Plate?           @relation(fields: [plateId], references: [id])
  productType     ProductType      @relation(fields: [productTypeId], references: [id])
  study           Study            @relation(fields: [studyId], references: [id])
  user            User?            @relation(fields: [userId], references: [id])
  accessories     QuoteAccessory[]
  elements        QuoteElement[]
}

model QuoteElement {
  id       Int    @id @default(autoincrement())
  quoteId  Int
  name     String
  quantity Int
  quote    Quote  @relation(fields: [quoteId], references: [id], onDelete: Cascade)
}

model QuoteAccessory {
  id          Int       @id @default(autoincrement())
  quoteId     Int
  accessoryId Int
  quantity    Int
  accessory   Accessory @relation(fields: [accessoryId], references: [id])
  quote       Quote     @relation(fields: [quoteId], references: [id])
}

model User {
  id                 String   @id @default(cuid())
  email              String   @unique
  password           String
  name               String?
  firstName          String?
  lastName           String?
  mustChangePassword Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  permissions        String[]
  role               Role     @default(USER)
  quotes             Quote[]
}

enum Role {
  ADMIN
  USER
}
